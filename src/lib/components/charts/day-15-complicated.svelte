<script>
	import { gsap } from 'gsap';
	import * as d3 from 'd3';
	import { onMount } from 'svelte';

	onMount(async () => {
		// Load MorphSVGPlugin dynamically
		const script = document.createElement('script');
		script.src = 'https://assets.codepen.io/16327/MorphSVGPlugin3.min.js'; // your trial URL
		script.onload = () => {
			// Now you can register the plugin
			gsap.registerPlugin(MorphSVGPlugin);
		};
		document.head.appendChild(script);
	});

	const paletteColors = ['#2C564F', '#93B4B5', '#E1E4E3', '#D4B2A9', '#694E50'];
	const colorScale = d3.scaleQuantize().domain([0, 100]).range(paletteColors);

	function hoverPath(event, index) {
		const targetElement = event.target;
		d3.select(paths[index].parentNode).raise();

		paths.forEach((path, i) => {
			if (i !== index) {
				gsap.to(path, {
					opacity: 0.5,
					duration: 0.5,
					ease: 'power2.Out'
				});
			} else {
				gsap.to(path, {
					opacity: 1,
					duration: 0.5,
					ease: 'power2.Out'
				});
			}
		});

		const centroid = [targetElement.dataset.centroidX, targetElement.dataset.centroidY];

		const rectWidth = 50;
		const rectHeight = 35;

		const x1 = centroid[0] - rectWidth / 2;
		const y1 = centroid[1] - rectHeight / 2;
		const x2 = centroid[0] + rectWidth / 2;
		const y2 = centroid[1] + rectHeight / 2;
		const rx = 4;
		const ry = 4;

		gsap.to(targetElement, {
			duration: 0.8,
			morphSVG: {
				shape: `
				M${x1 + rx},${y1}
				H${x1 + rectWidth - rx}
				A${rx},${ry} 0 0 1 ${x1 + rectWidth},${y1 + ry}
				V${y1 + rectHeight - ry}
				A${rx},${ry} 0 0 1 ${x1 + rectWidth - rx},${y1 + rectHeight}
				H${x1 + rx}
				A${rx},${ry} 0 0 1 ${x1},${y1 + rectHeight - ry}
				V${y1 + ry}
				A${rx},${ry} 0 0 1 ${x1 + rx},${y1}
				Z`
			},
			ease: 'power2.Out'
		});

		gsap.to(targetElement.parentNode.querySelector('g.path-text'), {
			opacity: 1,
			duration: 0.5,
			delay: 0.2,
			ease: 'power2.Out'
		});
	}

	function leavePath(event, index) {
		const targetElement = event.target;
		const originalPath = data[index].path;

		paths.forEach((path, i) => {
			gsap.to(path, {
				opacity: 1,
				duration: 0.5,
				ease: 'power2.Out'
			});
		});

		gsap.to(targetElement, {
			duration: 0.8,
			morphSVG: originalPath,
			ease: 'power2.Out'
		});

		setTimeout(() => {
			gsap.to(targetElement.parentNode.querySelector('g.path-text'), {
				opacity: 0,
				duration: 0.4,
				ease: 'power2.Out'
			});
		}, 500);
	}

	function getCentroids(pathEl) {
		if (pathEl) {
			const length = pathEl.getTotalLength();
			const numSamples = 100;
			const points = [];

			for (let i = 0; i <= numSamples; i++) {
				const p = pathEl.getPointAtLength((i / numSamples) * length);
				points.push([p.x, p.y]);
			}

			let centroid = d3.polygonCentroid(points);
			return centroid;
		}
	}

	let data = [
		{
			value: 20,
			path: 'M125.291 101.574L125.021 101.37L122.833 103.349L119.9 103.827L118.986 104.744L118.18 104.262L117.682 105.224L117.416 102.052L115.977 101.634L114.927 103.136L113.935 101.912L116.955 99.9515L118.146 100.379L120.767 98.2903L121.955 99.1421L125.044 99.1121L125.518 101.626L125.291 101.574ZM148.202 103.344L145.545 108.422L144.134 107.938L142.612 109.348L141.826 109.057L141.905 106.954L140.133 106.954L140.205 105.736L139.587 105.802L138.758 104.48L139.486 103.592L136.061 104.969L134.771 104.126L132.546 104.08L132.797 102.393L134.374 100.849L136.324 100.453L136.602 101.134L138.986 100.288L138.732 96.7228L135.644 96.3785L136.329 96.4836L136.245 98.0954L135.175 98.1528L134.77 100.077L134.061 99.1311L133.919 96.3943L132.649 96.4774L132.52 94.9248L130.221 96.9179L129.366 96.1312L128.789 96.6163L127.022 95.9611L125.845 96.9702L124.791 96.9443L123.732 95.7285L122.37 95.801L123.411 94.1601L124.641 94.3212L128.175 92.0149L126.358 90.6582L127.156 87.7592L125.228 88.3333L124.893 86.5819L122.663 85.9371L122.634 84.9443L121.225 83.1559L122.803 84.3722L123.414 84.009L122.763 82.8802L122.265 83.2152L121.051 82.5742L122.117 81.6516L119.144 78.3612L119.114 76.0787L114.079 73.8263L111.466 75.6211L109.549 73.7406L109.822 72.1224L108.852 69.5695L109.636 68.6924L109.05 67.3387L110.965 65.7606L110.375 62.7344L110.836 61.4843L112.245 62.3075L115.775 62.6444L112.924 58.8737L114.195 56.4996L113.32 54.8948L114.141 54.1978L113.511 49.6436L115.819 49.2231L115.99 48.3127L115.33 47.8163L118.25 45.0079L118.716 42.5846L117.474 40.1298L118.458 39.9259L120.206 42.6308L120.839 41.6018L119.5 40.4899L120.315 39.7126L123.735 40.907L126.634 40.4867L128.093 41.2763L128.868 40.8153L130.277 43.4108L132.325 43.6959L132.387 45.7397L132.803 46.52L135.069 47.0205L135.946 48.3951L134.693 49.3463L133.878 51.2692L134.587 52.2867L134.053 53.9476L132.936 54.7235L133.81 56.076L136.434 52.2011L136.991 54.0319L136.672 55.9582L137.381 56.385L138.869 55.4799L139.527 54.2178L141.271 55.5388L140.524 55.8249L140.403 56.81L142.685 56.6365L143.023 55.9749L144.979 55.4062L145.508 57.1235L147.332 57.4872L152.478 62.8593L153.588 61.8228L154.855 62.971L155.303 64.6221L153.342 65.8094L154.346 67.0503L155.743 66.9777L156.287 68.2512L157.188 68.1751L157.595 68.6726L156.962 69.6294L158.087 70.1016L157.636 71.0077L160.074 73.019L159.737 73.9691L159.086 73.5392L157.751 77.6443L156.397 77.6391L156.317 79.0789L155.53 79.8617L154.408 80.7374L153.626 80.7214L152.132 82.245L152.552 83.7825L151.345 83.6907L150.701 85.3299L152.817 87.3287L153.763 87.2469L153.284 85.6404L154.403 85.3692L154.399 86.3483L155.286 86.1975L154.445 86.6671L155.458 87.3477L154.099 87.4784L153.644 88.7368L154.302 89.3913L155.728 88.8775L155.286 88.0058L155.761 86.384L156.013 86.9737L157.155 86.145L158.058 86.5016L158.653 89.8744L157.972 90.8509L158.102 92.0651L157.023 92.7548L157.114 93.8389L157.984 94.29L155.711 95.8558L156.015 96.362L155.115 97.8359L155.259 101.005L154.012 101.266L153.325 100.728L148.202 103.344ZM142.184 58.7937L141.356 57.76L142.844 57.3375L143.237 57.8323L142.184 58.7937Z'
		},
		{
			value: 30,
			path: 'M89.6815 19.2503L89.4987 18.6742L89.8869 18.642L89.6815 19.2503ZM100.679 44.2974L96.2812 45.7504L93.871 48.3125L93.5604 50.2331L92.358 50.524L91.3423 49.1223L89.7982 49.2815L88.461 49.8559L88.6293 50.9119L87.54 51.7293L86.8215 51.0557L84.9358 51.7461L83.9349 51.1902L83.1349 52.1866L82.6902 51.3288L83.1326 50.3922L81.8172 50.8555L81.6426 49.611L80.8464 49.5562L80.3756 51.006L78.6823 50.0121L77.8432 50.3236L76.7572 49.3188L75.0079 49.4956L74.0433 51.555L72.5547 51.0982L71.2794 52.4989L71.1474 54.0221L69.4023 54.5456L69.075 56.4413L66.0642 56.1049L67.6873 58.7854L65.9118 61.2338L64.461 60.5468L60.0342 61.1152L52.0334 59.3998L50.6565 57.1925L47.1327 56.2371L45.9357 54.5837L46.0252 53.4989L44.164 52.184L43.286 49.2673L42.3555 48.9413L42.9652 46.9278L45.6289 46.5335L45.0509 44.3671L43.6546 42.8117L44.5456 41.055L44.5624 37.9097L46.5268 38.0704L52.0233 42.3871L53.3792 42.3063L53.3212 41.0917L58.6816 40.9076L59.3321 40.6024L59.0246 39.4111L59.8879 38.3118L62.0061 38.1279L60.976 35.3256L62.0594 34.4278L63.6464 35.1919L64.5468 34.3449L64.1607 33.5561L62.3996 32.9452L62.8107 31.8008L63.5107 32.0529L64.5715 29.7962L66.1663 30.4466L65.0427 27.8277L63.4416 27.6516L63.1683 26.6543L65.5326 26.3168L67.2028 24.5178L67.786 24.7039L67.93 23.3775L66.8944 23.1102L66.9757 22.6938L68.2088 23.0573L67.8417 22.2075L70.3737 22.7817L69.483 19.4878L66.8847 16.415L66.0482 14.1332L66.9985 13.2526L66.6805 12.189L67.3158 10.9659L70.8248 11.0754L69.8397 9.03841L71.3944 8.75152L71.2539 8.32778L75.1688 11.8526L75.642 9.06311L76.5215 9.13417L78.3852 15.4858L79.7972 16.1869L80.951 15.5551L82.6255 17.9358L84.5315 18.0634L85.5893 17.0381L86.0057 18.4092L87.781 18.4681L88.5944 19.2827L88.7277 20.5913L88.8789 19.6337L91.5261 20.5763L91.3167 19.6204L93.3507 19.2038L93.4257 21.1422L94.019 21.0925L94.3418 21.9841L95.4447 22.3871L96.6818 21.7715L96.6593 23.6188L97.4361 24.9522L96.8772 25.8949L98.0925 26.644L97.6887 26.9037L98.8088 30.0191L98.4962 30.8442L100.568 31.523L101.174 33.104L102.999 32.3944L105.926 33.896L104.481 35.7606L104.626 37.2299L103.525 37.8865L104.774 39.3483L102.734 40.3473L101.577 42.2106L100.766 41.9007L100.679 44.2974Z'
		},
		{
			value: 10,
			path: 'M75.022 132.932L75.4268 133.552L74.6909 133.963L74.6663 135.341L76.3167 137.292L75.8653 138.717L76.6133 139.793L76.192 141.137L74.7175 142.008L74.1005 141.074L72.1667 141.567L69.4661 141.119L68.763 140.146L68.067 140.831L67.4503 139.968L66.7058 140.975L66.9155 142.63L64.6549 142.585L63.4141 143.625L62.4897 146.621L57.944 146.655L57.4403 147.536L54.2792 145.794L53.2749 146.362L52.534 145.655L51.1105 146.119L47.4492 151.174L44.8646 151.901L42.961 151.025L42.4659 153.889L40.1162 153.783L36.2509 156.565L36.0184 157.312L34.0766 157.883L31.2297 156.304L29.4909 156.98L28.1773 154.043L28.6675 153.231L27.7478 152.849L28.5846 151.406L24.7959 148.821L24.9355 147.775L23.3616 148.087L23.8315 147.083L22.8825 146.999L21.4049 141.4L20.5004 140.683L18.9305 134.929L18.2256 134.186L19.1992 130.385L17.6023 130.519L17.1772 129.082L16.533 128.912L16.7303 127.719L17.3892 127.444L16.9948 126.034L18.0665 124.385L17.5942 122.931L19.2242 121.448L18.7153 120.513L19.1789 120.611L19.2575 117.629L17.3748 116.461L16.8452 115.226L14.9045 116.677L13.072 114.957L13.1552 112.394L14.4147 111.185L13.3375 110.319L12.8637 108.504L15.6169 107.652L15.7111 106.359L16.4752 105.399L17.1692 105.534L17.6964 102.395L20.0547 101.314L21.7494 101.97L20.2263 100.584L21.5647 100.298L22.5333 100.466L25.8224 103.58L28.2749 104.377L29.5172 106.241L31.0574 105.807L31.4246 104.149L34.2672 104.719L35.8492 104.33L37.3063 105.832L41.2343 105.347L41.9417 104.75L42.2002 106.155L44.3319 108.445L46.1037 108.964L47.5939 108.528L47.7523 109.229L48.9553 109.082L50.6934 110.142L53.7547 108.082L57.5367 107.827L57.6286 112.37L56.4223 111.133L55.9051 112.12L57.5363 115.385L60.3195 118.876L60.3351 120.565L62.1897 122.909L63.7402 122.938L62.5384 121.457L61.7051 117.98L63.7276 117.474L63.0993 115.86L64.1699 115.875L65.2708 121.559L64.778 122.421L68.0364 122.301L67.9119 123.638L69.4101 125.041L70.3578 124.21L70.2076 126.011L70.7373 126.655L71.1207 126.168L71.9209 126.497L71.8275 127.97L73.6924 129.488L72.9525 130.287L73.2236 131.406L74.5925 131.112L75.022 132.932Z'
		},
		{
			value: 65,
			path: 'M124.635 94.0507L123.487 93.9064L123.33 93.8862L123.245 94.0209L122.349 95.4381L121.461 94.841L121.263 94.7072L121.121 94.8991L121.048 94.9988L120.91 94.1034L120.893 93.9919L120.798 93.9311L119.78 93.2782L119.509 93.1049L119.408 93.4095L118.83 95.1485L118.803 95.2304L118.832 95.312L119.323 96.6788L117.048 97.0438L115.952 94.1382L115.781 93.6856L115.511 94.0865L115.094 94.7086L113.599 93.8451L113.355 93.7045L113.244 93.9628L112.779 95.0504L112.115 94.3979L111.788 94.0764L111.694 94.5254L111.472 95.6035L110.426 95.8648L110.194 95.9235L110.242 96.1581L110.265 96.261L110.107 96.3632L107.757 97.9097L105.056 97.8862L104.796 97.8838L104.804 98.1452L104.826 98.7461L103.908 98.9305L103.713 98.9703L103.708 99.17L103.704 99.3802L100.971 98.8853L100.864 98.8652L100.776 98.9303L98.4413 100.677L98.2154 100.194L98.1651 100.088L98.0521 100.058L96.558 99.6677L96.3581 98.8723L96.2457 98.4218L95.9319 98.7636L94.0281 100.832L92.6882 100.401L92.6009 100.373L92.5157 100.409L91.3675 100.888L90.7825 100.198L90.6825 100.08L90.5324 100.117L89.3243 100.416L88.6375 99.3007L88.4484 98.9936L88.2268 99.2781L87.8497 99.7638L85.9237 99.3943L85.8429 99.3792L85.7686 99.414L83.7308 100.386L82.4223 100.385L82.4592 99.6493L82.4684 99.4619L82.2918 99.4006L81.5139 99.1296L81.9217 98.2525L82.602 98.4185L82.768 98.4587L82.8665 98.3182L83.5919 97.278L84.8563 97.1558L85.0685 97.1353L85.0819 96.9227L85.3102 93.3578L85.3153 93.2884L85.2837 93.2274L84.2347 91.1859L84.1569 91.0335L83.9866 91.0515L82.2834 91.2266L81.6845 89.8993L82.3446 87.8648L83.6201 86.4262L85.4354 86.7606L85.7886 86.8255L85.7269 86.4715L85.6619 86.0915L87.6138 85.5548L88.5846 86.3835L88.4174 86.7385L88.3095 86.97L88.5426 87.0732L91.1508 88.229L90.7097 89.0708L90.6399 89.2049L90.726 89.3294L91.1081 89.8798L91.233 90.0583L91.4267 89.9596L93.6742 88.8215L93.7266 88.7945L93.7619 88.7472L94.7749 87.3839L95.8738 88.443L95.9714 88.5374L96.1035 88.5062L97.711 88.1366L97.77 88.1228L97.8156 88.0839L100.32 85.9644L100.381 85.9124L100.401 85.8346L100.825 84.1396L101.64 83.9386L101.988 83.8532L100.812 82.1064L101.232 81.0445L101.259 80.9766L101.245 80.9041L100.802 78.6715L105.016 76.41L105.636 76.8675L105.922 80.0263L105.939 80.2204L106.132 80.251L107.467 80.4613L107.624 80.4864L107.713 80.3546L108.697 78.8964L108.771 78.7869L108.722 78.6642L107.647 75.947L108.706 74.0256L109.529 73.9825L111.366 75.7846L111.513 75.9294L111.682 75.8128L114.172 74.1034L118.934 76.2333L118.96 78.3556L118.961 78.4501L119.025 78.5203L121.828 81.6215L120.954 82.3767L120.677 82.6159L121.001 82.7868L121.399 82.9969L121.095 83.3021L122.453 85.0261L122.48 85.9361L122.485 86.1181L122.661 86.1685L124.75 86.7656L125.049 88.3704L125.1 88.6435L125.366 88.5641L126.861 88.1183L126.179 90.5741L126.133 90.7381L126.269 90.8407L127.793 91.9887L124.635 94.0507ZM122.888 84.0614L121.739 83.1752L122.216 83.4275L122.348 83.4976L122.748 83.2283L123.141 83.911L122.888 84.0614Z'
		},
		{
			value: 30,
			path: 'M135.161 114.094L134.661 111.759L133.884 111.455L133.454 109.895L132.391 109.08L131.107 109.637L130.807 108.468L131.3 108.019L134.761 109.845L137.01 108.396L136.776 111.472L135.2 112.031L135.161 114.094ZM130.051 126.413L129.41 125.3L128.013 125.035L128.666 123.981L127.836 122.47L129.025 122.173L129.231 121.141L130.72 121.095L131.06 119.657L132.815 118.586L134.557 118.452L135.401 115.638L135.972 116.208L136.471 115.708L137.067 117.471L137.896 116.995L139.236 118.079L140.051 117.248L140.736 117.944L140.905 119.267L140.027 120.574L140.573 121.412L140.053 121.989L137.671 121.615L138.276 122.462L137.915 123.826L135.59 125.326L135.112 124.819L134.659 125.425L133.796 125.241L133.493 125.776L133.065 125.276L132.245 126.066L131.195 125.766L130.051 126.413ZM91.1198 143.923L91.5785 143.197L95.503 142.039L95.0074 140.208L91.7657 141.083L92.9279 139.148L94.5972 139.186L94.3176 136.941L91.0833 134.538L88.6029 135.453L87.905 136.541L85.5494 134.436L84.65 134.449L85.0745 133.445L84.2829 133.099L85.0092 132.791L85.9869 130.035L87.2127 129.995L87.7733 128.646L87.2626 128.004L88.0391 128.006L90.9353 125.31L92.0213 122.115L93.6005 120.154L97.3374 118.658L98.9187 117.142L99.6482 117.116L100.497 119.023L101.312 119.342L101.045 120.144L101.948 121.332L103.334 121.071L104.237 121.724L107.137 121.985L108.298 123.892L107.966 125.271L108.547 126.678L107.536 127.927L109.61 130.177L110.426 130.496L112.236 129.383L113.829 129.31L114.704 126.722L115.581 127.493L116.147 127.254L116.29 130.077L117.473 129.749L117.579 130.398L118.438 129.775L118.399 130.304L119.154 130.313L118.824 130.753L119.489 131.678L118.767 133.409L115.507 134.654L113.288 136.339L111.445 136.702L108.392 139.437L107.738 139.2L107.496 139.965L104.864 141.414L102.801 141.385L99.2473 143.247L98.2313 142.69L96.4196 143.581L93.9895 143.04L92.5459 143.97L91.1198 143.923Z'
		},
		{
			value: 95,
			path: 'M109.624 73.7276L108.554 73.7849L107.371 75.9312L108.49 78.7581L107.506 80.2157L106.171 80.0052L105.874 76.7337L105.036 76.1161L100.52 78.5404L101 80.954L100.53 82.1376L101.58 83.6973L100.619 83.9345L100.158 85.7753L97.6544 87.8941L96.0473 88.2644L94.7439 87.0081L93.5609 88.5997L91.3138 89.7383L90.9314 89.188L91.4953 88.1094L88.6442 86.846L88.8915 86.318L87.675 85.2804L85.3757 85.9117L85.4809 86.5158L83.5268 86.1554L82.1219 87.7397L81.4158 89.9144L80.126 87.9619L77.838 86.7293L77.2712 83.9527L75.117 83.51L74.948 82.9005L73.8116 83.0747L73.5213 82.0164L73.8725 81.1413L73.2151 80.4868L74.4977 79.4911L74.6834 76.2563L76.5145 75.1084L74.6169 73.7216L73.6086 71.4711L72.3563 71.1326L70.7102 69.5284L72.5083 67.1853L73.6457 68.5171L75.7515 68.0282L74.6649 65.6255L75.2593 63.9116L74.0006 61.4681L70.9477 58.436L68.962 59.1214L67.6931 58.7941L66.07 56.1136L69.0808 56.45L69.4081 54.5542L71.1559 54.0169L71.2879 52.4936L72.5632 51.093L74.0574 51.558L75.022 49.4986L76.7713 49.3218L77.849 50.3323L78.6963 50.0152L80.3897 51.0091L80.8661 49.5675L81.654 49.6279L81.823 50.8642L83.144 50.4091L82.7043 51.3318L83.1407 52.1953L83.9407 51.1989L84.9416 51.7548L86.8273 51.0643L87.5458 51.7379L88.6268 50.9261L88.4585 49.8701L89.7956 49.2958L91.3342 49.1282L92.3582 50.5244L93.5662 50.2418L93.8712 48.3129L96.2814 45.7507L100.679 44.2977L106.39 44.9025L107.377 47.4804L109.836 46.5849L111.04 47.764L112.366 47.8719L112.545 46.9559L113.299 46.8583L114.747 47.0046L115.417 47.8198L116.076 48.3162L115.9 49.2184L113.591 49.6389L114.221 54.1931L113.4 54.89L114.276 56.4948L113.005 58.869L115.855 62.6397L112.326 62.3028L110.916 61.4796L110.456 62.7297L111.04 65.7475L109.125 67.3257L109.719 68.6738L108.927 69.5564L109.897 72.1094L109.624 73.7276Z'
		},
		{
			value: 65,
			path: 'M75.0242 132.931L74.5947 131.111L73.2258 131.406L72.9547 130.286L73.6945 129.487L71.8297 127.97L71.9231 126.496L71.1229 126.167L70.7395 126.654L70.2098 126.01L70.36 124.21L69.4123 125.04L67.9141 123.638L68.0386 122.3L64.7802 122.42L65.2729 121.558L64.1721 115.874L63.1015 115.86L63.7298 117.474L61.7073 117.979L62.5406 121.456L63.7424 122.938L62.1919 122.908L60.3373 120.564L60.3216 118.875L57.5385 115.384L55.9073 112.119L56.4245 111.132L57.6308 112.369L57.5389 107.827L53.7569 108.082L50.6956 110.142L48.9575 109.081L47.7545 109.228L47.5961 108.527L46.1058 108.963L44.3341 108.444L42.2024 106.154L41.9439 104.749L41.2365 105.346L37.3085 105.832L35.8514 104.329L34.2694 104.719L31.4268 104.149L31.0596 105.806L29.5194 106.24L28.2771 104.376L25.8246 103.579L22.5355 100.465L21.5669 100.297L20.2285 100.583L21.7516 101.969L20.0569 101.314L17.6986 102.394L17.1714 105.534L16.4774 105.398L15.7133 106.358L15.6191 107.651L12.8659 108.503L12.9405 107.79L10.561 107.21L10.7391 106.077L8.63767 104.997L7.78524 103.497L9.03004 102.105L8.13219 99.7318L9.09431 98.3852L8.7748 97.6239L9.88303 96.7094L8.92833 95.2907L8.14293 95.1804L9.85295 93.6198L12.0881 92.9111L12.2498 91.1992L15.6908 92.8733L20.9826 92.229L22.1695 91.5388L26.0693 92.2291L26.1903 91.3522L28.6443 91.2194L29.7163 91.5587L29.9109 92.2956L31.3171 91.6627L32.1969 92.4327L34.6128 91.2046L34.2353 89.8555L32.0878 89.6735L30.5065 88.2908L30.8278 87.5683L34.8773 89.5199L35.2371 88.7113L33.675 86.6407L34.5381 85.5053L32.0065 85.0032L32.3436 80.8831L35.3618 81.6604L34.6546 79.1229L35.4127 78.0463L36.4715 77.9002L37.9901 78.8671L37.4667 76.4953L38.2375 75.169L39.7071 75.096L40.361 77.5006L40.6473 76.3678L41.6375 75.7255L44.0532 75.715L43.742 74.3213L44.8265 73.0491L46.0797 72.941L46.8478 71.6286L46.8437 70.6912L45.7929 70.1327L46.0164 68.5841L47.9125 67.7299L48.6575 68.7473L49.4077 67.1576L48.848 66.0035L50.0633 64.2093L48.4374 63.4231L48.4758 62.0473L49.6433 62.0089L50.429 60.2748L52.0338 59.3998L60.0402 61.1234L64.467 60.555L65.9178 61.2421L67.6933 58.7936L68.9622 59.121L70.9479 58.4356L74.0008 61.4676L75.2595 63.9112L74.6651 65.6251L75.7517 68.0278L73.6459 68.5167L72.5085 67.1848L70.7104 69.5279L72.3565 71.1322L73.6089 71.4707L74.6171 73.7212L76.5147 75.108L74.6836 76.2559L74.4979 79.4906L73.2154 80.4864L73.8728 81.1408L73.5215 82.016L73.8118 83.0742L74.9482 82.9001L75.1173 83.5096L77.2715 83.9523L77.8382 86.7289L80.1262 87.9615L81.416 89.914L82.1302 91.4946L81.4941 91.2838L79.8101 92.4532L77.5977 92.0135L76.2417 93.3479L72.619 93.2305L68.978 95.9339L69.1291 101.98L69.9539 102.883L71.0326 102.193L73.4417 103.212L74.4875 105.16L75.8854 105.822L77.2438 108.861L76.9479 112.255L78.2582 112.518L78.8488 114.399L78.4494 117.585L79.7772 118.716L79.9671 120.288L78.6476 120.44L78.2233 121.1L78.8628 122.104L78.2424 123.582L78.9937 123.498L78.491 123.969L79.218 125.336L76.5648 126.856L77.2659 129.277L75.8481 130.412L75.6162 132.593L75.0242 132.931Z'
		}
	];

	let paths = [];
</script>

<div
	class="viz-container m flex w-[1000px] flex-row items-start justify-center gap-8 bg-[#333] px-[32px] pt-6 pb-10 text-[#efefef]"
>
	<div class="text-content mt-20 w-1/3">
		<h2 class="title font-display mb-2 text-[2.5rem]">Some insights I made up</h2>
		<p class="font-body mb-8 max-w-[30ch] text-[1.125rem] leading-[1.5]">
			When asked about their process, people inexperienced at working with data tend to <strong
				>ask the same five questions:</strong
			> What is this data? How was it collected? Who are you? How did you get into my house? Gandalf?
		</p>

		<div class="legend flex w-full flex-row items-center justify-start gap-[2px]">
			{#each paletteColors as colour}
				<div class="h-8 w-8" style="background-color: {colour}"></div>
			{/each}
		</div>
	</div>
	<div class="svg-container w-2/3">
		<svg viewBox="0 0 173 168" fill="none" xmlns="http://www.w3.org/2000/svg">
			{#each data as d, index}
				{@const centroid = getCentroids(paths[index])}
				<!-- svelte-ignore a11y_no_static_element_interactions -->
				<g class="path-group">
					<path
						stroke-width="0.5"
						stroke="#ccc"
						fill={colorScale(d.value)}
						d={d.path}
						bind:this={paths[index]}
						data-centroid-x={centroid?.[0]}
						data-centroid-y={centroid?.[1]}
						on:mousemove={(e) => {
							hoverPath(e, index);
						}}
						on:mouseleave={(e) => {
							leavePath(e, index);
						}}
					/>

					{#if centroid}
						<g class="path-text opacity-0">
							<text
								x={centroid?.[0]}
								y={centroid?.[1]}
								class="font-body pointer-events-none fill-[#efefef] stroke-[#efefef] stroke-[0.35] text-[0.5rem] uppercase"
								dy="-0.4rem"
								text-anchor="middle">District {index + 1}</text
							>

							<line
								x1={centroid?.[0] - 25}
								y1={centroid?.[1] - 3}
								x2={centroid?.[0] + 25}
								y2={centroid?.[1] - 3}
								class="pointer-events-none stroke-[#efefef] stroke-[0.5px]"
							/>

							<text
								x={centroid?.[0]}
								y={centroid?.[1]}
								class="font-body pointer-events-none fill-[#efefef] text-[1rem]"
								dy="0.8rem"
								text-anchor="middle">{d.value}</text
							>
						</g>
					{/if}
				</g>
			{/each}
		</svg>
	</div>
</div>

<style>
	.viz-container {
		background: #333;
		background: -webkit-radial-gradient(circle, #343434, #333);
		background: radial-gradient(circle, #3d3d3d, #222);
	}

	.svg-container {
		max-width: 600px;
		height: auto;
	}

	svg {
		overflow: visible;
	}
</style>
